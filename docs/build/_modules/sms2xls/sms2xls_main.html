<!DOCTYPE html>

<html lang="hu" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sms2xls.sms2xls_main &#8212; Hello World 0.6.0 dokumentáció</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=601dbdee" />
    <script src="../../_static/documentation_options.js?v=f254bc6b"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=f0e509d9"></script>
    <link rel="index" title="Tárgymutató" href="../../genindex.html" />
    <link rel="search" title="Keresés" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigáció</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Általános tárgymutató"
             accesskey="I">nyitóoldal</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Modul Mutató"
             >modulok</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Hello World 0.6.0 dokumentáció</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Modul forráskód</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">sms2xls.sms2xls_main</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>sms2xls.sms2xls_main forráskódja</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>  <span class="c1"># Loggoláshoz modul</span>
<span class="kn">import</span> <span class="nn">re</span>  <span class="c1"># Reguláris kifejezésekhez modul</span>
<span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>  <span class="c1"># xml fájl olvasásához modul</span>

<span class="kn">from</span> <span class="nn">currency_converter</span> <span class="kn">import</span> <span class="n">CurrencyConverter</span>  <span class="c1"># Valutaváltó</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>  <span class="c1"># Excel táblázat kezeléshez modul</span>
<span class="kn">from</span> <span class="nn">openpyxl.formatting.rule</span> <span class="kn">import</span> <span class="n">Rule</span>
<span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="n">NamedStyle</span><span class="p">,</span> <span class="n">Font</span><span class="p">,</span> <span class="n">PatternFill</span>  <span class="c1"># Stílus importálása modul</span>
<span class="kn">from</span> <span class="nn">openpyxl.styles.differential</span> <span class="kn">import</span> <span class="n">DifferentialStyle</span>


<div class="viewcode-block" id="penzvalto">
<a class="viewcode-back" href="../../sms2xls.html#sms2xls.sms2xls_main.penzvalto">[docs]</a>
<span class="k">def</span> <span class="nf">penzvalto</span><span class="p">(</span><span class="n">mit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Árfolyam váltó függvény</span>
<span class="sd">    a bejövő mit hez 123,45 GBP</span>
<span class="sd">    kiszámolja, hogy az mennyi forintban&quot;&quot;&quot;</span>
    <span class="n">valuta</span> <span class="o">=</span> <span class="n">mit</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>  <span class="c1"># A bejövő valuta megnevezésének eltávolítása</span>
    <span class="n">mennyi</span> <span class="o">=</span> <span class="n">mit</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">ennyi</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">mennyi</span><span class="p">,</span> <span class="n">valuta</span><span class="p">,</span> <span class="s2">&quot;HUF&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">ennyi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="ujlap_letrehozasa">
<a class="viewcode-back" href="../../sms2xls.html#sms2xls.sms2xls_main.ujlap_letrehozasa">[docs]</a>
<span class="k">def</span> <span class="nf">ujlap_letrehozasa</span><span class="p">(</span><span class="n">lap_elnevezese</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Új munkalap létrehozása a munkafüzetben.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ujlap funkció meghívva&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alapértékek megadása&quot;&quot;&quot;</span>
    <span class="n">szotar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;A1&quot;</span><span class="p">:</span> <span class="s2">&quot;Dátum&quot;</span><span class="p">,</span>
        <span class="s2">&quot;A2&quot;</span><span class="p">:</span> <span class="s2">&quot;Nyitó összeg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B1&quot;</span><span class="p">:</span> <span class="s2">&quot;Pénzmozgás&quot;</span><span class="p">,</span>
        <span class="s2">&quot;C1&quot;</span><span class="p">:</span> <span class="s2">&quot;Valuta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;D1&quot;</span><span class="p">:</span> <span class="s2">&quot;LU egyenleg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;E1&quot;</span><span class="p">:</span> <span class="s2">&quot;Üzenet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;F1&quot;</span><span class="p">:</span> <span class="s2">&quot;Egyenleg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;G1&quot;</span><span class="p">:</span> <span class="s2">&quot;Ez hibádzik&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">kulcs</span><span class="p">,</span> <span class="n">ertek</span> <span class="ow">in</span> <span class="n">szotar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ws</span><span class="p">[</span><span class="n">kulcs</span><span class="p">]</span> <span class="o">=</span> <span class="n">ertek</span>
        <span class="n">ws</span><span class="p">[</span><span class="n">kulcs</span><span class="p">]</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">lap_elnevezese</span>  <span class="c1"># Az új lap elnevezése</span>
    <span class="n">ws</span><span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">szelessegek</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">kulcs</span><span class="p">,</span> <span class="n">ertek</span> <span class="ow">in</span> <span class="n">szelessegek</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">column_dimensions</span><span class="p">[</span><span class="n">kulcs</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">ertek</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;=D3-B3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
    <span class="c1"># A B2 cellába beírjuk a kezdőértéket első sms egyenlegéből kivonva az első levonást = nyitó egyenleg</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">sheet_view</span><span class="o">.</span><span class="n">zoomScale</span> <span class="o">=</span> <span class="mi">170</span>  <span class="c1"># A nézet kinagyítása az aktuális oldalon</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">FORMAT</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(asctime)-2s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span>  <span class="c1"># Loggolás formátumának beállításra</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">FORMAT</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
    <span class="p">)</span>  <span class="c1"># loggolás beálltása INFO-ra(csak a lényeg)</span>

    <span class="n">olvasando_fajl</span> <span class="o">=</span> <span class="s2">&quot;sms_full.xml&quot;</span>
    <span class="n">kiirando_fajl</span> <span class="o">=</span> <span class="s2">&quot;./balance.xlsx&quot;</span>

    <span class="c1"># xml fájl betöltése</span>
    <span class="n">mydoc</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">olvasando_fajl</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">CurrencyConverter</span><span class="p">()</span>

    <span class="c1"># Munkalap stílusának beálítása forintra</span>
    <span class="n">still</span> <span class="o">=</span> <span class="n">NamedStyle</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Pénzecske&quot;</span><span class="p">)</span>  <span class="c1"># Ilyen nevű stílus hozzáadása</span>
    <span class="n">still</span><span class="o">.</span><span class="n">number_format</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;#,##0 &quot;HUF&quot;;-#,##0 &quot;HUF&quot;&#39;</span>  <span class="c1"># A számformátum beállítása forintra</span>
    <span class="p">)</span>
    <span class="n">diff_style</span> <span class="o">=</span> <span class="n">DifferentialStyle</span><span class="p">(</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">PatternFill</span><span class="p">(</span><span class="n">bgColor</span><span class="o">=</span><span class="s2">&quot;C6EFCE&quot;</span><span class="p">,</span> <span class="n">fgColor</span><span class="o">=</span><span class="s2">&quot;006100&quot;</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># A feltételes formázás beállítása</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="n">dxf</span><span class="o">=</span><span class="n">diff_style</span><span class="p">)</span>  <span class="c1"># Feltételes kifejezés megadása</span>
    <span class="n">rule</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$B2&gt;0&quot;</span><span class="p">]</span>  <span class="c1"># Formula a felt. formázáshoz</span>

    <span class="c1"># Munkalap létrehozása a memóriában</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
    <span class="n">wb</span><span class="o">.</span><span class="n">add_named_style</span><span class="p">(</span><span class="n">still</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">mydoc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;sms&quot;</span><span class="p">)</span>  <span class="c1"># smsek beolvasása az items-be</span>

    <span class="n">lapnev</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;readable_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="p">)</span>  <span class="c1"># Az első sms dátumának kinyerése</span>
    <span class="n">lapnev</span> <span class="o">=</span> <span class="n">lapnev</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># Csak az évszám kivágása</span>

    <span class="n">cserek</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Egy.:&quot;</span><span class="p">,</span> <span class="s2">&quot;Egyenleg:&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Egy:&quot;</span><span class="p">,</span> <span class="s2">&quot;Egyenleg:&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Egy:+&quot;</span><span class="p">,</span> <span class="s2">&quot;Egyenleg:&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Egyenleg:+&quot;</span><span class="p">,</span> <span class="s2">&quot;Egyenleg: &quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;,-HUF&quot;</span><span class="p">,</span> <span class="s2">&quot; HUF&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">ujlap_letrehozasa</span><span class="p">(</span><span class="n">lapnev</span><span class="p">)</span>  <span class="c1"># beküldjük az új laphoz</span>
    <span class="n">sor</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># a táblázat írni kívánt első sora</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># belső változó</span>
    <span class="n">zd</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># debug változó</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>  <span class="c1"># SMS-ek beolvasása</span>
        <span class="c1"># if &#39;SIKERTELEN&#39; in elem.attributes[&#39;body&#39;].value:  # Ha a SIKERTELEN üzenetet kaptuk, akkor nem törődünk vele</span>
        <span class="c1">#     continue</span>
        <span class="n">tel</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span>
            <span class="s2">&quot;address&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># telefonszám kinyerése az üzenetből, később lehet szűrni.</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;readable_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># Dátum hozzáadása az rd változóhoz</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># Az üzenet szövege</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;contact_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># Az üzenetküldő neve</span>
        <span class="n">penz_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(-|\+)[0-9]+(,?|\.?)[0-9]+\s?,?-?[A-Z][A-Z][A-Z]&quot;</span>
        <span class="n">egyenleg_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(Egyenleg:\s)(\+?[0-9]+.[0-9]+\.?[0-9]+)&quot;</span>
        <span class="c1"># előjel - vagy +, utána 0 vagy több szám, aztán 0 vagy egy karakter,</span>
        <span class="c1"># 0 vagy több szám, 0 vagy 1 szóköz 0 vagy 1 , 0 vagy 1 - és három karakter a pénznem azonosításhoz.</span>
        <span class="c1"># x = re.findall(pattern, bd)</span>
        <span class="n">aktev</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># Az aktális évszám kinyerése a dátumból.</span>
        <span class="k">if</span> <span class="n">aktev</span> <span class="o">!=</span> <span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>  <span class="c1"># Ha ez nem egyezik a lap nevével akkor új lapot nyitunk</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">conditional_formatting</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;B2:B</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">),</span> <span class="n">rule</span><span class="p">)</span>
            <span class="c1"># összeadjuk a bevételeket. Ezt még az aktuális és nem új lapon tesszük.</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Bevétel:&quot;</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;=SUMIF(B2:B</span><span class="si">{}</span><span class="s1">,&quot;&gt;0&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Kiadás:&quot;</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;=SUMIF(B2:B</span><span class="si">{}</span><span class="s1">,&quot;&lt;0&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
            <span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">()</span>  <span class="c1"># itt csinálunk új lapot</span>
            <span class="n">wb</span><span class="o">.</span><span class="n">active</span>  <span class="c1"># itt pedig aktívvá tesszük.</span>
            <span class="n">ujlap_letrehozasa</span><span class="p">(</span><span class="n">aktev</span><span class="p">)</span>  <span class="c1"># meghívjuk rá az alapbeállításokat.</span>
            <span class="n">sor</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">penz_pattern</span><span class="p">,</span> <span class="n">bd</span>
            <span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c1"># megkeressük a pénzeket az üzenetből</span>
            <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">cserek</span><span class="p">:</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="n">egyenleg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">egyenleg_pattern</span><span class="p">,</span> <span class="n">bd</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Egyenleg értéke: </span><span class="si">{}</span><span class="s2"> - Üzi: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">egyenleg</span><span class="p">,</span> <span class="n">bd</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>  <span class="c1"># kivesszük a pontot (ezres elválasztó) az összegek közül</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;,-HUF&quot;</span><span class="p">,</span> <span class="s2">&quot; HUF&quot;</span>
            <span class="p">)</span>  <span class="c1"># Ha az üzenetben ,-HUF van azt átalakítjuk HUf-ra</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;HUF&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">):</span>  <span class="c1"># Ha benne van az összegben a HUF =&gt; forint alapú a dolog</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s2">&quot; HUF&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                <span class="p">)</span>  <span class="c1"># Kivesszük a HUF szöveget az excel pénznem felismerése miatt.</span>
                <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                    <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>  <span class="c1"># beírjuk az aktuális sorba a második oszlopba</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># ha nem HUF-ban van megadva a pénz</span>
                <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                    <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">x</span>
                <span class="p">)</span>  <span class="c1"># Beírjuk a harmadik oszlopba az összeget</span>
                <span class="n">forintban</span> <span class="o">=</span> <span class="n">penzvalto</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Átváltjuk az összeget forintra</span>
                <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                    <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">forintban</span>
                <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>  <span class="c1"># Ezt beírjuk a második oszlopba</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Valuta értéke:&quot;</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">egyenleg</span> <span class="o">=</span> <span class="n">egyenleg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rd</span><span class="p">)</span>  <span class="c1"># A dátumot beírjuk az első oszlopba</span>
            <span class="n">bd</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># Az üzenet elejéről a pontokat kivesszük még.</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">egyenleg</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>  <span class="c1"># Az egyenleget beírjuk a negyedik oszlopba</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">bd</span>
            <span class="p">)</span>  <span class="c1"># Az üzenetet beírjuk az ötödik oszlopba, ellenőrzés czéljából</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;=SUM(D</span><span class="si">{}</span><span class="s2">,B</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sor</span><span class="p">,</span> <span class="n">sor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
            <span class="c1"># Nem mindegy, hogy a képletbe elválsztónak , vagy ; van itt a ; hibát dob az excelben.</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
                <span class="n">row</span><span class="o">=</span><span class="n">sor</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;=D</span><span class="si">{}</span><span class="s2">-F</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sor</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Sorszám:</span><span class="si">{}</span><span class="s2">; Dátum: </span><span class="si">{}</span><span class="s2"> - Érték: </span><span class="si">{}</span><span class="s2"> - Üzi: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bd</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># ha DEBUG-ra van állítva a loggolás</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># sorszám növelése</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sorszám:</span><span class="si">{}</span><span class="s2">; - </span><span class="si">{}</span><span class="s2"> - Nem átutalásos sms - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">bd</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">sor</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Az összegeket az oszlop végén öszeadjuk és beírjuk az eredményt. és hozzáadjuk a stílust</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
            <span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;=SUM(B2:B</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>  <span class="c1"># B oszlop összegzése</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span>
            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># A betűtípust vastaggá tesszük az eredményen</span>
        <span class="c1"># logging.debug(&#39;Munkalap max sorszáma: {}&#39;.format(ws.max_row))</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">conditional_formatting</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;B2:B</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span><span class="p">),</span> <span class="n">rule</span>
    <span class="p">)</span>  <span class="c1"># feltételes formázás hozzáadása</span>
    <span class="c1"># összeadjuk a bevételeket.</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Bevétel:&quot;</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
        <span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;=SUMIF(B2:B</span><span class="si">{}</span><span class="s1">,&quot;&gt;0&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Kiadás:&quot;</span><span class="p">)</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span>
        <span class="n">row</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;=SUMIF(B2:B</span><span class="si">{}</span><span class="s1">,&quot;&lt;0&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">max_row</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">still</span>
    <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">kiirando_fajl</span><span class="p">)</span>  <span class="c1"># táblázat elmentése</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elkészült munkalapok:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">wb</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Gyorskeresés</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ok" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigáció</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Általános tárgymutató"
             >nyitóoldal</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Modul Mutató"
             >modulok</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Hello World 0.6.0 dokumentáció</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Modul forráskód</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">sms2xls.sms2xls_main</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Minden jog fenntartva 2023, Konta Boáz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>